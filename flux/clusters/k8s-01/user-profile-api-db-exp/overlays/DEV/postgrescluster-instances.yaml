# Always replace placeholder instances from `base`
- op: replace 
  path: /spec/instances
  value:
    - name: hwn04
      replicas: 1
      resources:
        limits:
          memory: 12Gi
          cpu: '4'
        requests:
          memory: 4Gi
          cpu: '1'
      dataVolumeClaimSpec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 25Gi
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/hostname
                    operator: In
                    values:
                      - hwn04.k8s-01.kontur.io
    - name: hwn03
      replicas: 1
      resources:
        limits:
          memory: 12Gi
          cpu: '4'
        requests:
          memory: 4Gi
          cpu: '1'
      dataVolumeClaimSpec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 25Gi
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/hostname
                    operator: In
                    values:
                      - hwn03.k8s-01.kontur.io
# Switchover section
# https://access.crunchydata.com/documentation/postgres-operator/latest/tutorials/cluster-management/administrative-tasks#changing-the-primary
# https://access.crunchydata.com/documentation/postgres-operator/latest/tutorials/cluster-management/administrative-tasks#targeting-an-instance
# 1. Requires fully-qualified POD id of new master 
# 2. New master must be in sink with current master
# 3. Its recommended to retain switchover section, to keep track of last desired master both in code and k8s
- op: add
  path: /spec/patroni/switchover
  value:
    enabled: true
    trigger-switchover: "2024-09-30 [01]"
    targetInstance: db-user-profile-api-exp-hwn04-REALID
    #type: Failover
